---
title: "Clean Officers and Shift Assignments"
output: pdf_document
---

```{r}
assignments <-
    read_csv(here("0-clean-data", "input", "bocar-ba_data", "assignments.csv")) %>%
    select(-appointed_month, -months_from_start_sq)

officers <-
    read_csv(here("0-clean-data", "input", "bocar-ba_data", "officers.csv"))

a <-
    assignments %>%
    filter(!is.na(end_time) & !is.na(start_time)) %>%
    group_by(shift, beat_assigned, start_time, end_time) %>%
    summarise(n = n()) %>%
    group_by(shift, beat_assigned) %>%
    mutate(prcnt = n / sum(n)) %>%
    filter(prcnt == max(prcnt)) %>%
    ungroup() %>%
    distinct(shift, beat_assigned, .keep_all = T)

b <-
    assignments %>%
    filter(!is.na(end_time) & !is.na(start_time)) %>%
    left_join(a, by = c("shift", "beat_assigned"))

missing <- assignments %>% filter(is.na(start_time) | is.na(end_time))
b <-
    assignments %>%
    mutate(prcnt = replace_na(.data[["prcnt"]], 0)) %>%
    group_by(shift, beat_assigned) %>%
    mutate(confidence = max(prcnt)) %>%
    filter(prcnt == confidence) %>%
    select(shift, beat_assigned, start_time.y, end_time.y, confidence) %>%
    ungroup() %>%
    right_join(missing)
```
