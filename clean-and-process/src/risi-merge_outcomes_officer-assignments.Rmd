---
title: "Risi - Merging Stops to Officer Assignments"
output: html_document
---

```{r, include = F}
library(knitr)
opts_chunk$set(message = F, echo = F, warning = F)

library(here)
source(here("functions.R"))

# Read in data
path <- paste("clean-and-process", "output", sep = "/")
officer_assignments <- my_read_csv(here(path, "officers_assignments_risi.csv"))
stops <- my_read_csv(here(path, "cleaned-stops.csv"))
arrests <- my_read_csv(here(path, "cleaned-arrests.csv"))
force <- my_read_csv(here(path, "cleaned-force.csv"))

# convert to data.table
setDT(officer_assignments)
setDT(stops)
setDT(arrests)
setDT(force)
```

## Changes to the data - Risi

* **Officer Shift Assignments**
    1. I compress all other ranks (not including missing ranks) that are not "Police Officer" or "Sergeant" into the "Other" Category. They make up such a small percentage of all shift assignments it seemed worthwhile to combine them. My one concern is that I am combining a bunch of very different types of ranks into one category.
    2. Drop the **months_from_start_sq** column.
    3. Format police officer race to be more concise.
* **Stops**
    1. Civilians with "X" for a gender are recoded as missing.
    2. Drop the **civilian_race_short** column.

```{r, results = "asis"}
officer_assignments <-
    officer_assignments %>%
    select(-months_from_start_sq) %>%
    mutate(rank = fct_other(rank, keep = c("POLICE OFFICER", "SERGEANT")),
           mutate(officer_race = str_replace(officer_race, "officer_", "")),
           civ.race = tolower(civ.race))

stops1 <-
    stops %>%
    mutate(civ.gender = fct_drop(na_if(civ.gender, "X")),
           civ.race = str_replace(civ.race, "civilian_", "")) %>%
    select(-civilian_race_short)

kable(GetSummaryCol(officer_assignments1, "rank"), format = "latex")
```

